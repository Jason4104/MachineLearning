---
title: "MachineLearning"
author: "Jason"
date: "5/24/2020"
output:
  pdf_document: default
  html_document: default
---

## Introduction
The assignment's purpose is to analyze the data provided on personal fitness actvity, and determine how much of a particular activity people routinely perform and how well they perform it. 

## Data Analysis Steps

1. Summary of dataset

Six young participants performed various fitness workout activities, and thier performance is recorded in 5 classes of data (Class A, B, C, D, E). 
Class A refers to the specified execution of the excercise, while the rest correspond with occurances of mistakes. 

2. Data Analysis

First the requried packages are loaded. 
```{r}
library(caret)
```

```{r}
library(doParallel)
library(foreach)
```

```{r}
set.seed(20150125)
```


Then the required datasets are loaded into R.

```{r}
setwd("~/R/MachineLearning")
trainingSrc   <- read.csv('pml-training.csv', na.strings=c("NA","#DIV/0!", ""))
testSrc       <- read.csv('pml-testing.csv' , na.strings=c("NA", "#DIV/0!", ""))
```

The following steps are for tidying data
```{r}
goodVars    <- which((colSums(!is.na(trainingSrc)) >= 0.6*nrow(trainingSrc)))
trainingSrc <- trainingSrc[,goodVars]
testSrc     <- testSrc[,goodVars]
```

```{r}
# remove problem id
testSrc <- testSrc[-ncol(testSrc)]
# fix factor levels
testSrc$new_window <- factor(testSrc$new_window, levels=c("no","yes"))
```

```{r}
trainingSrc <- trainingSrc[,-c(1,5)]
testSrc     <- testSrc[,-c(1,5)]
```

Now splitting data into training and testing sets.
```{r}
inTraining  <- createDataPartition(trainingSrc$classe, p = 0.6, list = FALSE)
training    <- trainingSrc[inTraining, ]
testing     <- trainingSrc[-inTraining, ]
```


For random forest modelling
```{r}
class <- training$classe
data  <- training[-ncol(training)]
```

```{r}
registerDoParallel()
rf <- train(data, class, method="parRF", 
    tuneGrid=data.frame(mtry=3), 
    trControl=trainControl(method="none"))
```

```{r}
rf
```

```{r}
plot(varImp(rf))
```

For confusion matrix testing set 
```{r}
testingPredictions <- predict(rf, newdata=testing)
confMatrix <- confusionMatrix(factor(testingPredictions),factor(testing$classe))
confMatrix
```

The accuracy is provided in the following code:
```{r}
confMatrix$overall[1]
```

to test the result on the test set:
```{r eval = FALSE}
pml_write_files = function(x){
  n = length(x)
  for(i in 1:n){
    filename = paste0("problem_id_",i,".txt")
    write.table(x[i],file=filename,quote=FALSE,row.names=FALSE,col.names=FALSE)
  }
}

answers <- predict(rf, testSrc)
pml_write_files(answers)
```

[1] B A B A A E D B A A B C B A E E A B B B
 Levels: A B C D E
